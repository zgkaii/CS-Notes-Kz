# 什么是数据库设计

数据库设计就是根据业务系统的具体需求，结合我们所选用的DBMS（数据库管理系统），为这个业务系统构造出最优的数据存储模型，并建立数据库中的表结构以及表与表之间的关联关系的过程。使之能有效的对应用系统中的数据进行存储，并可以高效的对已存储的数据进行访问。

| 优良的设计       | 糟糕的设计                   |
| ---------------- | ---------------------------- |
| 减少数据维护异常 | 存在数据插入、更新、删除异常 |
| 减少数据维护异常 | 存在大量数据冗余             |
| 节约存储空间     | 浪费大量存储空间             |
| 高效的访问       | 访问数据低效                 |



# 数据库设计的步骤

<img src="https://img-blog.csdnimg.cn/20201214234845562.png" style="zoom:80%;" />

**需求分析**——数据是什么，数据具有哪些属性，数据与属性的特点是什么。
**逻辑分析**——使用ER图对数据库进行逻辑建模，不需要考虑我们所选用的数据库管理系统。
**物理设计**——根据数据库自身的特点把逻辑设计转换为物理设计。
**维护设计**——对新的需求进行建表；索引优化；大表拆分。



# 需求分析

为了设计最优化的数据库，便于后期的扩展和维护，数据越来越多，越来越大会浪费空间，越来越杂乱，后期是很难处理和维护的。

1. 了解系统中索要存储的数据。
2. 了解数据的存储特点，比如有的数据有时效性，有的没有，有时效性的可以采取定期清理。
3. 了解数据的生命周期。

要搞清楚的一些问题

1. 实体及实体之间的关系（1对1，1对多，多对多）
2. 实体所包含的属性有什么？属性有很多，哪些属性是可以标识出这个实体的？
3. 哪些属性或属性的组合可以唯一标识一个实体？
4. 存储上有什么特性，增长量是什么样？



**实例演示**

以一个小型的电子商务网站为例，在这个电子商务网站的系统中包括了几个核心模块：用户模块，商品模块，订单模块，购物车模块，供应商模块。下面就对各个模块进行需求分析。

<img src="https://img-blog.csdnimg.cn/20201214233227760.png" style="zoom: 67%;" />

* 用户模块：用于记录注册用户信息
  包括属性：用户名，密码，电话，邮箱，身份证号，地址，姓名，昵称.....

  可唯一标识属性：用户名，身份证号，电话

  存储特点：随系统上线时间的增长，需要永久存储

* 商品模块：用于记录网站中说销售的商品信息
  包括属性：商品编码，商品名称，商品描述，商品品类，供货商名称，重量，有效期，价格......

  可唯一标识属性：商品编码，（商品名称，供货商名称）

  存储特点：对于下线商品可以归档存储（不能直接删除，可能跟订单有关）

* 订单模块：用于用户订购商品的信息
  包括属性：订单号，用户姓名，用户电话，收货地址，商品编号，商品名称，数量，价格，订单状态，支付状态.....

  可唯一标识属性：订单号

  存储特点：永久存储（分表，分库存储）

* 购物车模块：用于保存用户购物时选的商品
  包括属性：用户名，商品编号，商品名称，商品价格，加入时间，商品数量......
  可唯一标识属性：（用户名，商品编号，加入时间），购物车编号

  存储特点：不用永久存储（设置归档，清理规则）

* 供应商模块：用于保存供应商信息
  包括属性：供应商编号，供应商名称，联系人，电话，营业执照，供应商品.....

  可唯一标识属性:供应商编号，营业执照

  存储特点：永久存储



# 逻辑设计

## ER图（实体关系图）

ER图就是数据库模型关系的展示图。

1. 将需求转化为数据库的逻辑模型
2. 通过ER图的形式对逻辑模型进行展示
3. 同所选用的具体的DBMS无关

**表示方法**

实体型：用矩形框，矩形框内写明实体名

属性：用椭圆型表示，并用无向边将其与相应的实体连接起来。（可以连实体，也可以连联系）

联系：用菱形表示，菱形框内写明联系名，并用无向边分别与有关实体连接起来，同时在无向边旁边标上联系的类型。

数量：一对一（1:1），一对多（1：n），多对多（m:n）



**实例演示**

<img src="https://img-blog.csdnimg.cn/20201214235342989.png" style="zoom: 67%;" />

> 注：有的属性下面有下划线，就表示主键。

## 设计范式

### 设计范式概要

什么是数据库设计范式？

——也就是提供了一种准则，帮助我们建立简介高效且结构清晰的数据库设计，避免数据库插入、更新、删除、修改中的异常，并且为最大限度的避免数据库的冗余。

关系数据库有六种范式：第一范式（1NF）、第二范式（2NF）、第三范式（3NF）、巴德斯科范式（BCNF）、第四范式（4NF）和第五范式（5NF）。 满足最低要求的范式是第一范式（1NF）。 在第一范式的基础上进一步满足更多要求的称为第二范式（2NF），其余范式以次类推。 ... 越高的范式数据库的冗余度就越低。

但并不是说遵循的范式等级越高越好，范式过高虽然具有对数据关系有更好的约束性，但是也会导致表之间的关系更加繁琐，从而导致每次操作的表会变多，数据库性能下降。

通常，在我的设计中，最高也就遵循到 BCNF，普遍还是 3NF。

### 1NF

**数据库中的所有字段都是单一属性，不可再分的**。这个单一属性由基本数据类型所构成，例如整数、浮点数、字符串等。换句话说，第一范式要求数据库中的表都是二维表。

<img src="https://img-blog.csdnimg.cn/20201214235911315.png" style="zoom:67%;" />



### 2NF

1NF 只是设计数据库最基本的要求，但是数据会存在大量的冗余，并存在删除异常、插入异常、更新异常。例如：

<img src="https://img-blog.csdnimg.cn/20201215100946703.png" style="zoom: 67%;" />

**2NF 在 1NF 的基础上，消除了非主属性对码的部分函数依赖** 。**部分函数依赖**，指的是存在组合关键字中的某一关键字决定非关键字的情况，比如（学号，课名）—> （姓名），只需要根据学号即可唯一确定姓名。

<img src="https://img-blog.csdnimg.cn/20201215000202930.png" style="zoom: 67%;" />

### 3NF

**3NF 就是在 2NF 的基础上，消除非主属性对码的传递函数依赖**。**传递函数依赖**，指的是通过码唯一确定一个属性，然后通过该属性可以唯一确定另一个属性，所以就演变为了可以通过码唯一确定一个无函数依赖的属性（码——关系中的某个或者某几个属性的集合，用于唯一地标识每一条数据）。

<img src="https://img-blog.csdnimg.cn/20201215000433830.png" style="zoom:67%;" />

### BCNF

不存在**主属性**对于码的部分函数依赖和传递函数依赖，那么即符合 BCNF（前面的 2NF、3NF都是**非主属性**对码的部分函数依赖和传递函数依赖）。

例如下例，假设供应商联系只能受雇于一家供应商，每个供应商可以供应多个商品，则存在关系（供应商，商品ID）—> （供应商联系人，商品数量）与（供应商联系人，商品ID）—> （供应商，商品数量），不符合 BCNF。

<img src="https://img-blog.csdnimg.cn/20201215000609806.png" style="zoom:67%;" />



# 物理设计

物理设计要做什么？

1. 选择合适的数据库管理系统（应用特点和成本）
2. 定义数据库、表以及字段的命名规范（不同数据库对命名的规范是有差异的）
3. 根据所选的DBMS系统选择合适的字段类型
4. 反范式化设计（为了效率的提升而做的，可能是数据冗余）

## 数据库系统选择

<img src="https://img-blog.csdnimg.cn/20201215000752238.png" style="zoom:67%;" />

**MySQL数据库存储引擎**

<img src="https://img-blog.csdnimg.cn/20201215104834614.png" style="zoom:67%;" />

## 表及字段命令

![img](https://img-blog.csdnimg.cn/20201215110052692.png)

## 字段类型

![img](https://img2018.cnblogs.com/blog/1355675/201903/1355675-20190310234214428-959751267.png)

![img](https://img2018.cnblogs.com/blog/1355675/201903/1355675-20190310234222386-654431841.png)

![img](https://img2018.cnblogs.com/blog/1355675/201903/1355675-20190310234947881-122268962.png)

![img](https://img2018.cnblogs.com/blog/1355675/201903/1355675-20190310235043975-150822446.png)

## 具体字段类型的选取

![img](https://img2018.cnblogs.com/blog/1355675/201903/1355675-20190311000109976-356852827.png)

只是存储，很少用来查询，就使用int类型吧，因为不用转换了（比如生日很少使用，订单的时间类型经常使用，就可以使用datetime）

粒度可以根据需要来选择，比如可能只需要年，只需要年月

 

![img](https://img2018.cnblogs.com/blog/1355675/201903/1355675-20190311001357497-1060195512.png)

 

使用触发器后，如果业务变更会变的复杂和麻烦，影响业务逻辑

##  反范式化设计

**本质上就是用空间来换取时间，把数据冗余在多个表中，当查询时可以减少或者是避免表之间的关联.**

![img](https://img2018.cnblogs.com/blog/1355675/201903/1355675-20190311001501322-1576941339.png)

![img](https://img2018.cnblogs.com/blog/1355675/201903/1355675-20190311002357231-330675433.png)

我们的数据库在使用中读写比例大概在3:1。读是远远高于写的。虽然在写的时候增加了冗余，但是在读的时候我们大大的提高了效率

| 设计       | 优点                                     | 缺点                                         |
| ---------- | ---------------------------------------- | -------------------------------------------- |
| 范式设计   | 数据没有冗余，更新操作容易，数据一致性高 | 关联表查询太多，查询性能下降                 |
| 反范式设计 | 数据大量冗余，查询性能较快               | 更新性能下降，磁盘空间消耗较大，数据一致性低 |

# 维护优化

![img](https://img2018.cnblogs.com/blog/1355675/201903/1355675-20190311002516458-1714095733.png)

1、要记录清楚数据库的每一个列是什么意思

2、索引可能会应为数据量的增大和业务的改变而变得不适用

3、导致查询缓慢等问题

## 如何维护数据字典

![img](https://img2018.cnblogs.com/blog/1355675/201903/1355675-20190311003136440-310031600.png)

 

## 如何维护索引

![img](https://img2018.cnblogs.com/blog/1355675/201903/1355675-20190311003816806-2077243978.png)

 

## 表结构的维护

![img](https://img2018.cnblogs.com/blog/1355675/201903/1355675-20190311004317340-954769476.png)

使用自定义函数导致列中的索引失效

## 数据库中适合的操作

![img](https://img2018.cnblogs.com/blog/1355675/201903/1355675-20190311004420937-866251837.png)

不要使用全文索引，可以使用搜素引擎工具

## 数据库表的垂直拆分和水平拆分

![img](https://img2018.cnblogs.com/blog/1355675/201903/1355675-20190311005127062-1294619800.png)

# 参考

* [数据库设计的基础——数据库范式](https://juejin.cn/post/6844904183611523086)
* https://www.imooc.com/learn/117